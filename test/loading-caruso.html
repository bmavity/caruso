<!DOCTYPE html>
<html>
  <head>
    <title>Test</title>
    <style>
      .customers .customer.inactive {

      }
        .customers .customer.inactive .details {
          display:none;
        }
      .customers .customer.active {

      }
        .customers .customer.active .details {
        }
    </style>
  </head>
  <body style="background-color:#ccc">
    <h2 class="status" style="color:red;">
      <span id="name1" style="color:black">Adrianna</span>
      loves
      <span class="name2" style="color:green">Tristan</span>
      &amp;
      <span class="name3" style="color:purple">Brian</span>
    </h2>
    <div id="activeCustomers" class="customers">
      <script type="text/html-template">
        <div class="customer inactive">
          <h2 class="name"></h2>
          <input name="status">
          <a href="#" class="trigger" rel="showDetails">Show Details</a>
          <div class="details">
            <div class="looks"></div>
            <input name="myOpinion">
          </div>
        </div>
      </script>
    </div>
    <div id="inactiveCustomers" class="customers">
      <script type="text/html-template">
        <div class="customer inactive">
          <h2 class="name"></h2>
          <input name="status">
          <a href="#" class="trigger" rel="showDetails">Show Details</a>
          <div class="details">
            <div class="looks"></div>
            <input name="myOpinion">
          </div>
        </div>
      </script>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/h5bp/js/libs/jquery-1.7.1.min.js"><\/script>')</script>
<!--
    <script src="mav.js"></script>
    <script src="wagner.js"></script>
    <script src="eventemitter2.js"></script>
    <script src="wagner.init.js"></script>
    <script src="caruso.js"></script>
    <script src="caruso.init.js"></script>
    <script src="caruso.dataSource.js"></script>
    <script src="caruso.init.wagner.js"></script>
    <script src="testingGround.js"></script>
-->
    <script src="../lib/caruso.module.js"></script>
    <script src="../includes/operatic.js"></script>
    <script src="../lib/caruso.js"></script>
    <script src="../lib/caruso.init.js"></script>
    <script>
(function() {
  var caruso = operatic.caruso
    , bound = caruso.bind($('body'))
    ;
  bound.inject({
    name1: 'Adrianna*'
  , name2: 'Tristan*'
  , name3: 'Brian*'
  , activeCustomers: [{
      id: 1
    , name: 'brian'
    , status: 'awesome'
    , details: {
        looks: 'average'
      , myOpinion: 6.7
      }
    }
    , {
      id: 2
    , name: 'adrianna'
    , status: 'awesomer'
    , details: {
        looks: 'totally hawt'
      , myOpinion: 'i mean smokin'
      }
    }]
  , inactiveCustomers: [{
      id: 3
    , name: 'brian'
    , status: 'awesome'
    , details: {
        looks: 'average'
      , myOpinion: 6.7
      }
    }
    , {
      id: 4
    , name: 'adrianna'
    , status: 'awesomer'
    , details: {
        looks: 'totally hawt'
      , myOpinion: 'i mean smokin'
      }
    }]
  });
})();
/*
(function() {
  var module = new wagner.Module(), exports = module.exports, define = module.define, component = module.component;
  component('activeCustomers', function() {
    var env = this
      ;

    env.addToChain('setting value', 'sucka three', function(data, next) {
      if(data.key === 'looks') {
        data.$match.text("really really really fuckin' hawt");
      } else {
        next();
      }
    });

    env.states({
      initial: 'inactive'
    , inactive: {
        showDetails: {
          before: function($ele, next) {
            next($ele.find('.details'));
          }
          , transition: {
            show: 'slide'
          }
          , endState: 'active'
        }
      }
    , active: {
        showDetails: {
          before: function($ele, next) {
            next($ele.find('.details'));
          }
          , transition: {
            hide: 'slide'
          }
          , endState: 'inactive'
        }
      }
    });

    var ds2 = new caruso.AjaxDataSource('the url');
    var sds = new caruso.SortedDataSource(ds2);
    env.dataSource(sds);
    sds.setSort({
      key: 'name'
    , order: 'desc'
    });
    sds.init();
    setTimeout(function() {
      sds.setSort({
        key: 'status'
      , order: 'desc'
      });
    }, 2000);
    setTimeout(function() {
      sds.add({
        id: 3
      , name: 'adrianna'
      , status: 'awesomer'
      , details: {
          looks: 'totally hawt'
        , myOpinion: 'i mean smokin'
        }
      });
    }, 3000);
  });
})();

(function() {
  var module = new wagner.Module(), exports = module.exports, define = module.define, component = module.component;
  component('inactiveCustomers', function() {
    var env = this
      ;

    env.states({
      initial: 'active'
    , inactive: {
        showDetails: {
          before: function($ele, next) {
            next($ele.find('.details'));
          }
          , transition: {
            show: 'slide'
          }
          , endState: 'active'
        }
      }
    , active: {
        showDetails: {
          before: function($ele, next) {
            next($ele.find('.details'));
          }
          , transition: {
            hide: 'slide'
          }
          , endState: 'inactive'
        }
      }
    });
  });
})();
/*
  $('#customers').children().each(function() {
    console.log($(this).data('caruso.data'));
  });

        source.on('initial data', function(data, key) {
          var $children = $ele.children()
            , matchedData = []
            , unmatchedData = []
            ;
          if($children.length) {
            if(data.hasOwnProperty('length')) {
              var keyedData = {};
              data.forEach(function(dataItem) {
                keyedData[dataItem[key]] = dataItem;
              });
              $children.each(function() {
                var $child = $(this)
                  , $match = $child.find('[name=' + key + ']')
                  , matchVal = $match.val()
                  , matchingData = matchVal && keyedData[matchVal]
                  ;
                if($match.length && matchingData) {
                  $child.data('caruso.data', matchingData);
                }
              });
            }
          } else {
            inject(data);
          }
        });
*/
    </script>
  </body>
</html>
